{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/schemas/nota-fiscal.schema.json",
  "title": "Nota Fiscal Extract Output",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "numero_fatura",
    "data_emissao",
    "data_vencimento",
    "empresa_emissora",
    "cliente",
    "itens",
    "tributos",
    "subtotal_itens_centavos",
    "valor_total_fatura_centavos"
  ],
  "properties": {
    "numero_fatura": {
      "type": "string",
      "minLength": 1,
      "description": "Invoice number normalized as text without spaces/accented keys."
    },
    "data_emissao": {
      "type": "string",
      "format": "date",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
    },
    "data_vencimento": {
      "type": "string",
      "format": "date",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
    },
    "empresa_emissora": {
      "type": "object",
      "additionalProperties": false,
      "required": ["nome", "cnpj", "endereco"],
      "properties": {
        "nome": { "type": "string", "minLength": 1 },
        "cnpj": {
          "type": "string",
          "minLength": 14,
          "description": "CNPJ can be masked or numeric string depending on source formatting."
        },
        "endereco": { "type": "string", "minLength": 1 }
      }
    },
    "cliente": {
      "type": "object",
      "additionalProperties": false,
      "required": ["nome", "cnpj", "endereco"],
      "properties": {
        "nome": { "type": "string", "minLength": 1 },
        "cnpj": {
          "type": "string",
          "minLength": 11,
          "description": "For PF/PJ this field can contain CPF/CNPJ as source text string."
        },
        "endereco": { "type": "string", "minLength": 1 }
      }
    },
    "itens": {
      "type": "array",
      "default": [],
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "descricao",
          "quantidade",
          "valor_unitario_centavos",
          "valor_total_item_centavos"
        ],
        "properties": {
          "descricao": { "type": "string", "minLength": 1 },
          "quantidade": { "type": "integer", "minimum": 0 },
          "valor_unitario_centavos": { "type": "integer", "minimum": 0 },
          "valor_total_item_centavos": { "type": "integer", "minimum": 0 }
        }
      }
    },
    "tributos": {
      "type": "array",
      "default": [],
      "description": "If no tax is present in source, return empty array.",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["tipo", "valor_centavos"],
        "properties": {
          "tipo": { "type": "string", "minLength": 1 },
          "valor_centavos": { "type": "integer", "minimum": 0 }
        }
      }
    },
    "subtotal_itens_centavos": {
      "type": "integer",
      "minimum": 0
    },
    "valor_total_fatura_centavos": {
      "type": "integer",
      "minimum": 0
    }
  }
}
